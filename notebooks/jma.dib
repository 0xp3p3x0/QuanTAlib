#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"aliases":[],"name":"csharp"}]}}

#!csharp

#r "nuget: ScottPlot"

using ScottPlot;
using Microsoft.DotNet.Interactive.Formatting;
Formatter.Register(typeof(ScottPlot.Plot), (p, w) =>
    w.Write(((ScottPlot.Plot)p).GetSvgXml(600, 300)), HtmlFormatter.MimeType);

#!csharp

    static double[] CalculateEmaWeights(int period, int barCount)
    {
        double[] weights = new double[barCount];
        double alpha = 2.0 / (period + 1);
        double weightSum = 0;
        for (int i = 0; i < barCount; i++)
        {
            weights[i] = Math.Pow(1 - alpha, i) * alpha;
            weightSum += weights[i];
        }
        for (int i = 0; i < barCount; i++)
        {
            weights[i] /= weightSum;
        }
        return weights;
    }

#!csharp

Plot plt = new();
double[] weights = CalculateEmaWeights(10, 30);
var bar = plt.Add.Bars(weights);
plt.Add.Annotation("EMA(10) Weights Chart", Alignment.UpperRight);
var vline = plt.Add.VerticalLine(10.5, width: 1, ScottPlot.Color.FromColor(System.Drawing.Color.Black));
plt.Display();

#!csharp

#r "..\lib\obj\Debug\QuanTAlib.dll"
using QuanTAlib;
QuanTAlib.Formatters.Initialize();

#!csharp

TSeries Spike = new() { 0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 };
TSeries SpikeJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.000552258,-0.000634509,-0.000546757,-0.000418793,-0.000300729,-0.000207311,-0.000138943,-9.12206E-05,-5.89537E-05,-3.76301E-05,-2.3779E-05,-1.49021E-05,-9.27419E-06,-5.73755E-06,-3.53147E-06,-2.16396E-06,-1.32082E-06,-8.03405E-07,-4.87171E-07,-2.94594E-07,-1.77697E-07,-1.06942E-07,-6.42273E-08,-3.85007E-08,-2.3039E-08,-1.37646E-08,-8.21143E-09,-4.89192E-09,-2.91062E-09,-1.72971E-09,-1.02679E-09,-6.08884E-10,0.57216502,0.329278183,0.111882943,0.02038988,-0.00579442,-0.009287974,-0.007184303,-0.004666439,-0.002864099,-0.001904733,-0.001310906,-0.000931811,-0.000671491,-0.000485478,-0.000348532,-0.000247325,-0.00017322,-0.000119743,-8.17596E-05,-5.51943E-05,-3.68781E-05,-2.44116E-05,-1.60241E-05,-1.04391E-05,-6.75421E-06,-4.34304E-06,-2.77694E-06,-1.76649E-06,-1.11846E-06,-7.05115E-07,-4.42777E-07,-2.77032E-07,-1.72747E-07};
TSeries Impulse = new() {0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 };
TSeries ImpulseJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.000552258,-0.000634509,-0.000546757,-0.000418793,-0.000300729,-0.000207311,-0.000138943,-9.12206E-05,-5.89537E-05,-3.76301E-05,-2.3779E-05,-1.49021E-05,-9.27419E-06,-5.73755E-06,-3.53147E-06,-2.16396E-06,-1.32082E-06,-8.03405E-07,-4.87171E-07,-2.94594E-07,-1.77697E-07,-1.06942E-07,-6.42273E-08,-3.85007E-08,-2.3039E-08,-1.37646E-08,-8.21143E-09,-4.89192E-09,-2.91062E-09,-1.72971E-09,-1.02679E-09,-6.08884E-10,0.57216502,0.901443203,1.013326146,1.033716025,1.027921605,1.018633631,1.011449329,1.00678289,1.004181353,1.002789251,1.001927584,1.001373173,1.000992004,1.000715566,1.000511417,1.000361007,1.000251496,1.000172974,1.000117554,1.000079021,1.000052594,1.000034694,1.000022702,1.000014747,1.000009517,1.000006105,1.000003895,1.000002473,1.000001563,1.000000984,1.000000617,1.000000385,1.00000024 };
TSeries Triangle = new() {0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2 };
TSeries TriangleJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1.581506365,2.477581913,3.488202137,4.521009922,5.548667586,6.567230027,7.578661013,8.58543932,9.589389814,10.59167402,11.59299,12.59374694,13.59418202,14.59443201,15.59457564,16.59465816,17.59470556,18.59473279,19.59474843,20.58051252,21.54811378,22.51426859,23.48461289,24.45940996,25.43756768,26.41800953,27.39996296,28.38293081,29.36660689,30.35080461,31.33541428,32.32037808,33.30566888,33.60143774,33.44671824,32.76693797,31.6743202,30.43080342,29.17128703,27.99351702,26.87387633,25.82071013,24.78859626,23.78848957,22.78804437,21.80499239,20.81281231,19.83220792,18.84031318,17.85875467,16.86608953,15.88343316,14.89022444,13.90693661,12.913562,11.92991131,10.93653629,9.952765982,8.959539985,7.975860495,6.982898571,5.999241471,5.006469162,4.022728123,3.03008006 };
TSeries Sawtooth = new() { 0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 };
TSeries SawtoothJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1.581506365,2.477581913,3.488202137,4.521009922,5.548667586,6.567230027,7.578661013,8.58543932,9.589389814,10.59167402,11.59299,12.59374694,13.59418202,14.59443201,15.59457564,16.59465816,17.59470556,18.59473279,19.59474843,20.58051252,21.54811378,22.51426859,23.48461289,24.45940996,25.43756768,26.41800953,27.39996296,28.38293081,29.36660689,30.35080461,31.33541428,32.32037808,33.30566888,33.60143774,14.4444661,3.393709459,-0.381095509,-1.087259716,-0.909541115,-0.630797534,-0.431229171,-0.301811285,-0.214698512,-0.155744776,-0.113122186,-0.081470163,-0.057940086,-0.040643203,-0.028127973,-0.019222458,-0.012985805,-0.008681539,-0.005749677,-0.003775885,-0.002460865,-0.001592844,-0.001024611,-0.000655382,-0.00041706,-0.000264159,-0.000166597,-0.000104653,-6.55023E-05,-4.08602E-05,-2.54092E-05};
TSeries Sine = new() {0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0.39,0.56,0.72,0.84,0.93,0.99,1,0.97,0.91,0.81,0.68,0.52,0.33,0.14,-0.06,-0.26,-0.44,-0.61,-0.76,-0.87,-0.95,-0.99,-1,-0.96,-0.88,-0.77,-0.63,-0.46,-0.28,-0.08,0.12,0.31,0.49,0.66,0.79,0.9,0.97,1,0.99,0.94,0.85,0.73,0.58,0.41,0.22,0.02,-0.17,-0.37,-0.54,-0.7,-0.83,-0.92,-0.98,-1,-0.98,-0.92,-0.82,-0.69,-0.54,-0.36,-0.17,0.03,0.23,0.42,0.59,0.74 };
TSeries SineJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.39,0.490864998,0.636321842,0.775644322,0.887670382,0.96723697,1.002698087,0.994210739,0.97484737,0.899842304,0.760161465,0.598500604,0.417065675,0.226525923,0.028051774,-0.173435555,-0.363836139,-0.541493028,-0.701687888,-0.830525691,-0.924540364,-0.976284568,-1.000434282,-1.002692279,-0.985640624,-0.936128884,-0.822093878,-0.639429302,-0.423527364,-0.195049986,0.026649267,0.230378819,0.416212213,0.587236179,0.726645879,0.840145143,0.922346148,0.974370173,0.998644546,1.001578941,0.980088368,0.929810972,0.819518184,0.64081841,0.420019212,0.180501608,-0.042184191,-0.258138204,-0.444721632,-0.611894672,-0.75049231,-0.857197199,-0.932680738,-0.97935623,-1.000589656,-0.999280528,-0.971643229,-0.914409033,-0.805305412,-0.628446355,-0.408677504,-0.1685546,0.064709114,0.282360193,0.471727962,0.635976367 };
TSeries Chirp = new() {0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0.93,0.27,-0.59,-1,-0.71,0.05,0.75,1,0.67,0,-0.67,-0.99,-0.85,-0.34,0.31,0.81,1,0.82,0.35,-0.22,-0.71,-0.98,-0.95,-0.66,-0.2,0.31,0.72,0.96,0.98,0.78,0.43,-0.01,-0.43,-0.77,-0.96,-0.99,-0.85,-0.58,-0.23,0.16,0.51,0.79,0.95,1,0.92,0.73,0.47,0.15,-0.17,-0.47,-0.72,-0.9,-0.99,-0.99,-0.9,-0.74,-0.52,-0.26,0.01,0.28,0.53,0.73,0.88,0.97,1,0.97 };
TSeries ChirpJMA = new() {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.93,0.561053238,-0.153321154,-0.747445764,-0.827042762,-0.356534975,0.329365258,0.808933304,0.80763454,0.359594859,-0.283946188,-0.780875466,-0.902685225,-0.697018971,-0.08283369,0.516589836,0.888855938,0.948751948,0.779079352,0.219827259,-0.413194221,-0.823676712,-0.966424648,-0.980133795,-0.734382753,-0.187559001,0.381690406,0.771852221,0.950406869,0.992587561,0.906965755,0.568135762,0.057898772,-0.428978529,-0.765170274,-0.939400473,-0.997544642,-0.960715401,-0.780475234,-0.40457484,0.048409781,0.4620447,0.75237274,0.922499475,0.99544436,0.990182899,0.907531892,0.699745667,0.36999061,-0.018042543,-0.374980934,-0.659514743,-0.851442288,-0.960664115,-1.004200191,-0.986072069,-0.905943806,-0.759349136,-0.521563135,-0.211047868,0.115261471,0.410601038,0.645846908,0.817157712,0.92809772,0.989536632 };
TSeries White = new() { -0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,0.03,-0.4,-0.47,0.19,-0.4,-0.23,0.31,0.41,0.19,0.16,-0.5,-0.31,-0.21,0.25,0.18,-0.48,-0.1,0.38,0.29,-0.38,-0.08,-0.21,0.34,0.01,-0.46,0.28,-0.48,0.11,0.02,-0.37,0.19,-0.2,0.1,0.24,0.08,-0.22,-0.12,0.15,0.36,-0.43,-0.03,-0.32,0.45,-0.5,-0.04,-0.04,-0.08,-0.18,0.13,-0.33,-0.19,0.36,-0.39,0.2,-0.31,0.28,-0.13,-0.07,-0.29,0.37,0.03,-0.25,-0.06,-0.3,-0.08,-0.09};
TSeries WhiteJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.03,0.000615565,-0.061226573,-0.092671199,-0.129255272,-0.162995702,-0.151470277,-0.092881104,-0.022100823,0.041629282,0.034531011,-0.00690482,-0.057127156,-0.070531037,-0.052561514,-0.063900933,-0.081162364,-0.053975569,-0.003614763,0.007307236,-0.000322726,-0.024840458,-0.018839953,-0.005344501,-0.031085715,-0.032009583,-0.063752546,-0.078008451,-0.076403205,-0.0929075,-0.088024391,-0.087878012,-0.07544228,-0.041364649,-0.00440562,0.005778424,-0.002553758,-0.001239273,0.028362304,0.012498302,-0.007029157,-0.043178553,-0.020123975,-0.061044025,-0.088517916,-0.099905576,-0.102094773,-0.106909564,-0.093572608,-0.097302028,-0.110538244,-0.086147961,-0.087969842,-0.07229411,-0.074396177,-0.054072297,-0.040179437,-0.034162407,-0.050151585,-0.033698183,-0.0108771,-0.011076622,-0.020007675,-0.048169729,-0.073949068,-0.091959026};
TSeries Gauss = new() { -0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,0,0.03,0.11,-0.1,-0.43,-0.08,0.36,-0.04,-0.04,-0.21,-0.3,0.26,0.2,0.28,0.2,0.27,-0.01,-0.1,-0.23,-0.13,-0.41,-0.23,-0.07,-0.21,0.32,-0.18,-0.48,0.3,0.46,-0.2,0.52,-0.81,-0.25,-0.21,-0.12,-0.18,0.18,0.52,0.29,0.44,0.18,-1.2,0.38,0.24,0.06,0.28,0.34,0.3,-0.13,0.19,-0.5,0.59,-0.36,0.22,-0.23,0.24,0.39,0.13,-0.33,-0.57,-0.23,0.49,-0.13,0.76,0.59,0.61};
TSeries GaussJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.001854025,0.011540727,0.011884188,-0.022070199,-0.057369472,-0.051431987,-0.036997357,-0.025664992,-0.032226648,-0.06037637,-0.061423963,-0.036892161,0.008572487,0.058119604,0.108100023,0.133835735,0.129098894,0.093270858,0.04601512,-0.021358793,-0.0867853,-0.129632777,-0.15961389,-0.142828375,-0.123790362,-0.144340705,-0.119583475,-0.02732417,0.022509545,0.093793303,-0.099826639,-0.216160255,-0.274653675,-0.288848025,-0.280078428,-0.227015768,-0.063702909,0.064855103,0.171342223,0.240000551,-0.247868893,-0.178073225,-0.05581201,0.021314181,0.088914096,0.152366403,0.202793617,0.210356779,0.204598892,0.135245478,0.147739125,0.092238129,0.061372665,0.024723623,0.013480088,0.038466805,0.069932732,0.063288258,-0.019191085,-0.097103187,-0.063479437,-0.041277564,0.101208843,0.226564254,0.3324448};
TSeries B = new() { -0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0.4,-0.4,0,-0.28,0.41,-0.54,0.65,-0.75,0.84,-0.91,0.96,-0.99,1,-0.99,0.96,-0.92,0.85,-0.77,0.67,-0.56,0.44,-0.3,0.17,-0.03,-0.11,0.25,-0.39,0.51,-0.63,0.73,-0.82,0.89,-0.95,0.98,-1,0.99,-0.97,0.93,-0.86,0.78,-0.69,0.58,-0.46,0.33,-0.19,0.05,0.09,-0.23,0.36,-0.49,0.61,-0.71,0.81,-0.88,0.94,-0.98,1,-1,0.98,-0.94,0.88,-0.8,0.71,-0.6,0.48,-0.35,0.22,-0.08,-0.06};
TSeries BJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0.28,-0.249647418,-0.236137311,-0.092463769,-0.135681216,0.081810351,-0.10737838,0.158877264,-0.121022022,0.157409626,-0.110712469,0.113649408,-0.075459625,0.058705622,-0.03146432,0.018768059,-0.005724484,0.002866003,-0.005347622,-0.002037477,0.001061143,-0.004823112,0.007612129,-0.008318097,0.01176324,-0.023491307,0.038452069,-0.053167834,0.069454301,-0.083773765,0.088390998,-0.093198114,0.083064505,-0.076311968,0.060105968,-0.040755859,0.02672713,-0.017252438,0.003870028,-0.006498957,0.003238924,0.000547304,-0.00071129,0.005308638,-0.005960141,0.008773952,-0.011210224,0.015074455,-0.034416451,0.046128851,-0.058583481,0.078264889,-0.078887801,0.091633873,-0.079308124,0.078776195,-0.057654673,0.048302298,-0.026718666,0.01992987,-0.004897167,0.00466543,-0.006232267,-0.002021568,-0.001167666,-0.00561375};
TSeries HF = new() { -0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,-0.6,0.6,0,0.14,-0.76,-0.96,-0.28,0.66,0.99,0.41,-0.54,-1,-0.54,0.42,0.99,0.65,-0.29,-0.96,-0.75,0.15,0.91,0.84,-0.01,-0.85,-0.91,-0.13,0.76,0.96,0.27,-0.66,-0.99,-0.4,0.55,1,0.53,-0.43,-0.99,-0.64,0.3,0.96,0.75,-0.16,-0.92,-0.83,0.02,0.85,0.9,0.12,-0.77,-0.95,-0.26,0.67,0.99,0.4,-0.56,-1,-0.52,0.44,0.99,0.64,-0.3,-0.97,-0.74,0.17,0.92,0.83,-0.03,-0.86};
TSeries HFJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.009659222,-0.040599553,-0.163792103,-0.267881527,-0.222132422,-0.006792776,0.1652809,0.189468517,-0.003756276,-0.171611112,-0.219673237,-0.03300223,0.141560684,0.221586098,0.063591357,-0.110778668,-0.209827889,-0.090081173,0.08575362,0.199874895,0.119603923,-0.05541179,-0.183498905,-0.142326793,0.03293993,0.17327896,0.162956455,-0.017391711,-0.169867254,-0.189994223,-0.010065626,0.152957221,0.205341138,0.038713249,-0.126568002,-0.205841173,-0.06402948,0.098789546,0.193539028,0.08428847,-0.078530746,-0.186526214,-0.113784853,0.048749086,0.170952283,0.135372811,-0.025218031,-0.158841788,-0.15234029,0.014510823,0.161290048,0.183155809,0.014187729,-0.143632601,-0.196231797,-0.04068555,0.119889198,0.19852797,0.06310687,-0.094480351,-0.18637946,-0.082123757,0.075749245,0.181223306,0.110597239};
TSeries ImpulseHF = new() { -0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0,0,0.05,-0.25,-0.32,-0.09,0.22,0.33,0.14,-0.18,-0.33,-0.18,0.14,0.33,0.22,-0.1,-0.32,-0.25,0.05,0.3,0.28,0,-0.28,-0.3,-0.04,0.25,0.32,0.09,-0.22,-0.33,-0.13,0.18,0.33,0.18,0.86,0.67,0.79,1.1,1.32,1.25,0.95,0.69,0.72,1.01,1.28,1.3,1.04,0.74,0.68,0.91,1.22,1.33,1.13,0.81,0.67,0.83,1.15,1.33,1.21,0.9,0.68,0.75,1.06,1.31,1.28,0.99,0.71};
TSeries ImpulseHFJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.003461081,-0.011642869,-0.048606972,-0.081865532,-0.066699028,0.004769395,0.061214257,0.066684176,-0.000581688,-0.05790682,-0.073898443,-0.009849831,0.049232603,0.075125066,0.019740445,-0.040036202,-0.073433985,-0.032178662,0.028208365,0.067331942,0.040941342,-0.017234625,-0.059553851,-0.045931589,0.013039637,0.059810689,0.055076438,-0.007043616,-0.058392452,-0.064847235,-0.004085511,0.050829451,0.366220782,0.54546044,0.661280091,0.828257429,1.047815691,1.178437926,1.232617161,1.175409162,1.094265475,1.032680473,1.028996048,1.060829073,1.086121863,1.064452157,1.00462356,0.955209515,0.952483181,1.004256436,1.051127644,1.05790993,1.004105353,0.953026934,0.936162097,0.986603514,1.039284876,1.065119067,1.021791115,0.96988946,0.9395387,0.974261146,1.026993387,1.062164997,1.037299819};
TSeries SawtoothHF = new() { -0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0,0,2.7,-0.8,-0.8,3.6,9.3,11.95,10.05,6.3,5,8.3,14.1,17.95,17.25,13.55,11.2,13.25,18.75,23.55,24.2,20.95,17.75,18.45,23.35,28.8,30.8,28.35,24.7,24.05,28,33.75,37,35.65,31.85,28.05,-3.2,1.5,4.8,3.75,-0.8,-4.6,-4.15,0.1,4.25,4.5,0.6,-3.85,-4.75,-1.3,3.35,4.95,2,-2.8,-5,-2.6,2.2,4.95,3.2,-1.5,-4.85,-3.7,0.85,4.6,4.15,-0.15,-4.3};
TSeries SawtoothHFJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.162339653,0.601887587,-0.138147159,1.309223994,5.107713418,8.974394558,10.40295885,9.064227513,7.107532593,7.252214128,10.29253719,14.3422971,16.59550868,15.89741763,13.81397238,12.94610444,15.38646358,19.54492633,22.58742652,23.29047041,21.14259379,19.88472662,20.67288266,24.48774716,28.15328646,29.31043033,28.30880272,26.87074867,26.39868719,29.62694489,33.64590149,35.40176299,35.40262728,32.44992039,16.31419263,6.006475565,2.921574936,2.223213675,0.363348158,-2.56004758,-4.212503588,-4.511484408,-2.01012721,0.279699545,1.556338949,0.733997068,-0.907882416,-1.868190362,-1.078138134,0.727883722,1.831670906,1.372206184,-0.576868493,-1.796676323,-1.608469841,0.271762471,1.547428697,1.743028127,-0.036241215,-1.385714085,-1.83810226,-0.352149236,1.087926207,1.814346637,0.651940618};
TSeries SineG = new() { -0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0.2,-0.2,0,0,0.59,0.83,0.74,0.5,0.91,1.36,0.93,0.87,0.6,0.38,0.78,0.53,0.42,0.14,0.01,-0.45,-0.71,-0.99,-1,-1.36,-1.22,-1.07,-1.17,-0.56,-0.95,-1.11,-0.16,0.18,-0.28,0.64,-0.5,0.24,0.45,0.67,0.72,1.15,1.52,1.28,1.38,1.03,-0.47,0.96,0.65,0.28,0.3,0.17,-0.07,-0.67,-0.51,-1.33,-0.33,-1.34,-0.78,-1.21,-0.68,-0.43,-0.56,-0.87,-0.93,-0.4,0.52,0.1,1.18,1.18,1.35};
TSeries SineGJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.135063871,0.399412629,0.568872884,0.655439988,0.727204599,0.985254566,1.112235515,1.150214911,1.056603797,0.850932718,0.730112974,0.654269037,0.593070789,0.475249449,0.324220683,-0.021881615,-0.391582296,-0.739173509,-0.929605151,-1.151983599,-1.258910502,-1.30184982,-1.308701469,-1.196229363,-1.106382636,-1.053626396,-0.828404263,-0.426205314,-0.204837262,0.164514163,0.092688593,0.072220649,0.140038433,0.294703177,0.445530475,0.711949941,1.09235409,1.287255822,1.387026593,1.415102546,0.594414816,0.516509742,0.518120551,0.503063413,0.473652641,0.42622561,0.326965192,-0.029781089,-0.268764145,-0.778292891,-0.896555805,-1.023481762,-1.077021387,-1.109129526,-1.097761437,-1.012370223,-0.917088527,-0.848344828,-0.814846374,-0.770797888,-0.329923163,-0.06907177,0.531362662,0.905121738,1.154870446};
TSeries ChirpG = new() { 0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,0,0.01,1.3,0.3,-0.48,-1.1,-1.14,-0.03,1.11,0.96,0.63,-0.21,-0.97,-0.73,-0.65,-0.06,0.51,1.08,0.99,0.72,0.12,-0.35,-1.12,-1.21,-1.02,-0.87,0.12,0.13,0.24,1.26,1.44,0.58,0.95,-0.82,-0.68,-0.98,-1.08,-1.17,-0.67,-0.06,0.06,0.6,0.69,-0.41,1.33,1.24,0.98,1.01,0.81,0.45,-0.3,-0.28,-1.22,-0.31,-1.35,-0.77,-1.13,-0.5,-0.13,-0.13,-0.32,-0.29,0.3,1.22,0.75,1.73,1.59,1.58};
TSeries ChirpGJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.3,0.740001439,-0.042556461,-0.769542976,-1.105423545,-0.563312376,0.451052389,0.881976808,0.812897183,0.233094721,-0.529073435,-0.756396598,-0.770130145,-0.466413792,0.150821753,0.776095562,0.987773287,1.009651331,0.657200693,0.082303074,-0.720745569,-1.110291722,-1.190420458,-1.17195634,-0.566303969,-0.176459783,0.062321499,0.809328574,1.253329503,1.191011656,1.114939918,-0.013000588,-0.494064023,-0.797251223,-0.979338687,-1.096367683,-1.088245888,-0.763286688,-0.425472648,0.071930431,0.417858737,0.292028504,0.721092503,1.008767012,1.117325384,1.141306605,1.099161127,0.967706129,0.467009246,0.096168919,-0.606193593,-0.784356282,-0.999208322,-1.061687357,-1.088313979,-1.011248918,-0.770847088,-0.545534111,-0.400816068,-0.317677099,-0.160314675,0.460017228,0.755349431,1.21020452,1.463883777,1.588694006};
TSeries Complex = new() { 175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.1,175.6,175.44,176.27,176.04,176.99,175.49,175.68,174.34,176.4,174.05,174.4,174.2,176.16,175,177.72,174.33,176.96,174.62,174.76,170.9,171.12,171.05,170.01,169.24,172.64,171.96,175.72,174.16,175.81,177.3,178.38,176.75,177.19,175.55,178.49,176.52,178.45,178.04,178.25,177.8,176.97,172.94,174.92,173.98,172.29,171.19,172.54,172.11,175.32,175.63,176.65,173.8,176.04,172.74,175.24,171.84,171.54,172.17,171.85,172.38,170.78,173.49,173.69,171.71,174.38,173.99,174.83};
TSeries ComplexJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,175.44,175.6810893,175.8382605,176.4050072,176.1609533,175.974375,175.2236006,175.5533713,174.9884683,174.615941,174.3770309,175.0623389,175.27043,176.32984,175.7164891,176.0973323,175.5682376,175.188465,173.2282697,171.8336671,171.1425322,170.4440719,169.7014159,170.7344496,171.3188789,173.3480163,174.1515576,175.0636931,176.2771412,177.5128437,177.8875485,177.87213,177.3582234,177.4250293,177.357529,177.4802419,177.6010334,177.7295287,177.8216397,177.8136695,175.6183153,174.6439913,174.2091633,173.3115795,172.1448758,171.6820873,171.5763613,172.9091515,174.0986078,175.3366475,175.4742249,175.5553884,174.8667808,174.6161513,173.8022615,172.9494297,172.4487235,172.1450989,171.9957087,171.7495045,171.879957,172.2274366,172.3995248,172.7694942,173.0853957,173.5105324};
TSeries Market = new() { 68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,68.75,68.25,67.75,67.75,72.75,74.75,72.25,71.25,71.75,72.75,77.75,76,76,76,74.75,75.5,74.75,73.75,74,74.75,72.25,72.5,72.25,74.5,74.75,75.75,75.75,75.75,74.25,73.75,74.75,72,71.75,72.5,72.25,71,72,71.75,71.75,73.25,72.5,73.75,74,76.75,75.75,75,75.75,74.5,74.25,73.5,71.75,70.5,69,70.5,70,68.75,67.25,68.5,70.75,70,70.5,68.25,68.25,68.25,63.75,64.25};
TSeries MarketJMA = new() { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,68.75,69.11126386,68.28856883,67.88047045,70.61221899,73.37735131,73.16751764,72.5016599,72.10679156,72.09353157,73.81775589,74.94089624,75.60649969,75.96759618,75.9599046,75.85557397,75.64181903,75.25160642,74.84644659,74.61728297,74.17868676,73.67238488,73.1842394,73.10785283,73.34958901,73.85707168,74.42911902,74.93038851,75.09287507,74.94649321,74.80499937,74.33318217,73.66893412,73.12071155,72.71498835,72.26423085,71.9702028,71.79260915,71.69675123,71.86943138,72.07979919,72.43023876,72.85788116,73.73196015,74.51914619,75.00208707,75.33621901,75.38718804,75.22566212,74.87443544,74.12468013,72.85729881,71.22401395,70.37858241,69.96256092,69.53514922,68.68810853,68.25445186,68.63035835,69.0349436,69.44967111,69.46200796,69.24863466,68.96050991,66.39400988,65.00557185};

#!csharp

public class Jma1 : AbstractBase
{
    public readonly int Period;
    private readonly double _phase;
    private readonly int _vshort, _vlong;
    private CircularBuffer _voltyShort;
    private CircularBuffer _vsumBuff;
    private CircularBuffer _avoltyBuff;

    private double _beta, _len1, _pow1;
    private double _upperBand, _lowerBand, _prevMa1, _prevDet0, _prevDet1, _prevJma;
    private double _p_UpperBand, _p_LowerBand, _p_prevMa1, _p_prevDet0, _p_prevDet1, _p_prevJma;

    public Jma1(int period, double phase = 0, int vshort = 10) : base()
    {
        if (period < 1)
        {
            throw new ArgumentOutOfRangeException(nameof(period), "Period must be greater than or equal to 1.");
        }
        Period = period;
        _vshort = vshort;
        _vlong = 65;
        _phase = Math.Clamp((phase * 0.01) + 1.5, 0.5, 2.5);

        _voltyShort = new CircularBuffer(vshort);
        _vsumBuff = new CircularBuffer(_vlong);
        _avoltyBuff = new CircularBuffer(2);

        Name = "JMA";
        WarmupPeriod = period * 2;
        Init();
    }

    public override void Init()
    {
        _upperBand = _lowerBand = _prevMa1 = _prevDet0 = _prevDet1 = _prevJma = 0.0;
        _p_UpperBand = _p_LowerBand = _p_prevMa1 = _p_prevDet0 = _p_prevDet1 = _p_prevJma = 0.0;
        _avoltyBuff.Clear();
        _avoltyBuff.Add(0, true);
        _avoltyBuff.Add(0, true);
        base.Init();
    }

    protected override void ManageState(bool isNew)
    {
        if (isNew)
        {
            _lastValidValue = Input.Value;
            _index++;
            // Save current state
            _p_UpperBand = _upperBand;
            _p_LowerBand = _lowerBand;
            _p_prevMa1 = _prevMa1;
            _p_prevDet0 = _prevDet0;
            _p_prevDet1 = _prevDet1;
            _p_prevJma = _prevJma;
        }
        else
        {
            // Restore previous state
            _upperBand = _p_UpperBand;
            _lowerBand = _p_LowerBand;
            _prevMa1 = _p_prevMa1;
            _prevDet0 = _p_prevDet0;
            _prevDet1 = _p_prevDet1;
            _prevJma = _p_prevJma;

        }
    }
    protected override double Calculation()
    {
        ManageState(Input.IsNew);

        if (_index == 1)
        {
            _prevMa1 = _prevJma = Input.Value;
            return Input.Value;
        }

        double del1 = Input.Value - _upperBand;
        double del2 = Input.Value - _lowerBand;
        double volty = Math.Max(Math.Abs(del1), Math.Abs(del2));

        _voltyShort.Add(volty, Input.IsNew);
        double vsum = _vsumBuff.Newest() + 0.1 * (volty - _voltyShort.Oldest());
        _vsumBuff.Add(vsum, Input.IsNew);

        double avolty = 0;
        for (int i = 0; i < _vsumBuff.Count; i++) { avolty += _vsumBuff[i]; }
        avolty /= _vsumBuff.Count;

        double rVolty = (avolty > 0) ? volty / avolty *20: 0;
        double _len1 = Math.Max((Math.Log(Math.Sqrt(Period)) / Math.Log(2.0)) + 2.0, 0);
        double _pow1 = Math.Max(_len1 - 2, 0.5);

        rVolty = Math.Clamp(rVolty, 1.0, Math.Pow(_len1, 1.0 / _pow1));

        double _pow2 = Math.Pow(rVolty, _pow1);
        double _beta = 0.45 * (Period - 1) / (0.45 * (Period - 1) + 2);
        double len2 = Math.Sqrt(0.5 * (Period - 1)) * _len1;

        double _Kv = Math.Pow (_beta,  Math.Sqrt(_pow2)) *1.5;

        _upperBand = (del1 > 0) ? Input.Value : Input.Value - (_Kv * del1);
        _lowerBand = (del2 < 0) ? Input.Value : Input.Value - (_Kv * del2);

        double alpha = Math.Pow(_beta, _pow2);
        double ma1 = alpha * (_prevMa1 - Input.Value) + Input.Value;
        _prevMa1 = ma1;

        double det0 = _beta * (_prevDet0 - Input.Value + ma1) + Input.Value - ma1;
        _prevDet0 = det0;
        double ma2 = ma1 + _phase * det0;

        double det1 = ((1 - alpha) * (1 - alpha) * (ma2 - _prevJma)) + (alpha * alpha * _prevDet1 );
        _prevDet1 = det1;
        double jma = _prevJma + det1;
        _prevJma = jma;

        IsHot = _index >= WarmupPeriod;
        return jma;
    }
}

#!csharp

TSeries ma = Triangle;
TSeries re = TriangleJMA;
TSeries out1 = new();
TSeries out2 = new();
Jma calc = new(10);
Jma1 calc1 = new(10);
foreach (var value in ma) { out1.Add(calc.Calc(value)); }
foreach (var value in ma) { out2.Add(calc1.Calc(value)); }
Plot plt = new();
var sigplot = plt.Add.Signal(ma.v.ToArray()[60..80]);
var jmaplot = plt.Add.Signal(re.v.ToArray()[60..80]); sigplot.Color = ScottPlot.Colors.Red; sigplot.LineWidth = 2; jmaplot.LineWidth = 3;
//var jma1plot = plt.Add.Signal(out1.v.ToArray()[60..80]); jma1plot.Color = ScottPlot.Colors.Purple; jma1plot.LineWidth = 3;
var jma2plot = plt.Add.Signal(out2.v.ToArray()[60..80]); jma2plot.Color = ScottPlot.Colors.Blue; jma2plot.LineWidth = 3;
plt.Display();

#!csharp

#r "nuget: Plotly.net.Interactive"
using Plotly.NET.Interactive;
